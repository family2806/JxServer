local tbAwardItem = 
{
	{szName="绿水晶", nCount=2, tbProp={4, 240, 1, 1, 0, 0}},
	{szName="蓝水晶", nCount=2, tbProp={4, 238, 1, 1, 0, 0}},
	{szName="紫水晶", nCount=2, tbProp={4, 239, 1, 1, 0, 0}},
	{szName="猩红宝石", nCount=2, tbProp={4, 353, 1, 1, 0, 0}},
	{szName="仙草露", nCount=5, tbProp={6, 1, 71, 1, 0, 0}},
	{szName="仙草露(小) ", nCount=5, tbProp={6, 1, 124, 1, 0, 0}},
	{szName="仙草露(中) ", nCount=5, tbProp={6, 1, 123, 1, 0, 0}},
	{szName="仙草露(大) ", nCount=5, tbProp={6, 1, 122, 1, 0, 0}},
	{szName="4级玄晶矿石", nCount=1, tbProp={6, 1, 147, 4, 0, 0}},
	{szName="5级玄晶矿石", nCount=1, tbProp={6, 1, 147, 5, 0, 0}},
	{szName="6级玄晶矿石", nCount=1, tbProp={6, 1, 147, 6, 0, 0}},
	{szName="7级玄晶矿石", nCount=1, tbProp={6, 1, 147, 7, 0, 0}},
	{szName="8级玄晶矿石", nCount=1, tbProp={6, 1, 147, 8, 0, 0}},
	{szName="武林秘籍", nCount=1, tbProp={6, 1, 26, 1, 0, 0}},
	{szName="洗水晶", nCount=1, tbProp={6, 1, 22, 1, 0, 0}},
	{szName="铁罗汉", nCount=5, tbProp={6, 1, 23, 1, 0, 0}},
	{szName="般若心经", nCount=5, tbProp={6, 1, 12, 1, 0, 0}},
	{szName="心心相印符", nCount=5, tbProp={6, 1, 18, 1, 0, 0}},
	{szName="披风", nCount=5, tbProp={6, 1, 15, 1, 0, 0}},
	{szName="百果露", nCount=5, tbProp={6, 1, 73, 1, 0, 0}},
	{szName="天山宝露", nCount=5, tbProp={6, 1, 72, 1, 0, 0}},
	{szName="柔情巾帼霓裳", nQuality=1, nCount=1, tbProp={0, 190}},
	{szName="柔情慧心玉佩", nQuality=1, nCount=1, tbProp={0, 193}},
	{szName="柔情凤仪戒指", nQuality=1, nCount=5, tbProp={0, 192}},
	{szName="柔情淑女项链", nQuality=1, nCount=5, tbProp={0, 191}},
	{szName="侠骨情意结", nQuality=1, nCount=1, tbProp={0, 189}},
	{szName="侠骨铁血衫", nQuality=1, nCount=1, tbProp={0, 186}},
	{szName="侠骨丹心戒", nQuality=1, nCount=5, tbProp={0, 188}},
	{szName="侠骨多情环", nQuality=1, nCount=5, tbProp={0, 187}},
	{szName="定国钨砂发冠", nQuality=1, nCount=1, tbProp={0, 160}},
	{szName="定国青纱长衫", nQuality=1, nCount=1, tbProp={0, 159}},
	{szName="定国银蚕腰带", nQuality=1, nCount=1, tbProp={0, 163}},
	{szName="定国赤绢软靴", nQuality=1, nCount=1, tbProp={0, 161}},
	{szName="定国紫藤护腕", nQuality=1, nCount=1, tbProp={0, 162}},
	{szName="黄金图谱 - 四空降魔戒刀", nCount=1, tbProp={6, 1, 249, 1, 0, 0}},
	{szName="黄金图谱 - 撼天金环大眼神锤", nCount=1, tbProp={6, 1, 254, 1, 0, 0}},
	{szName="黄金图谱 - 冰寒弹指飞刀", nCount=1, tbProp={6, 1, 309, 1, 0, 0}},
	{szName="黄金图谱 - 幽胧金蛇发带", nCount=1, tbProp={6, 1, 294, 1, 0, 0}},
	{szName="黄金图谱 - 无魇洗象玉扣", nCount=1, tbProp={6, 1, 277, 1, 0, 0}},
	{szName="黄金图谱 - 栖凰凤仪刀", nCount=1, tbProp={6, 1, 284, 1, 0, 0}},
	{szName="黄金图谱 - 同仇亢龙护手", nCount=1, tbProp={6, 1, 332, 1, 0, 0}},
	{szName="黄金图谱 - 魔煞鬼谷幽冥枪", nCount=1, tbProp={6, 1, 339, 1, 0, 0}},
	{szName="黄金图谱 - 霜晶千年寒铁", nCount=1, tbProp={6, 1, 364, 1, 0, 0}},
	{szName="黄金图谱 - 凌岳无极玄玉佩", nCount=1, tbProp={6, 1, 357, 1, 0, 0}},
	{szName="唐倪甲", nCount=5, tbProp={0, 2, 4, 10, nil, 0}},
	{szName="天蚕护腕", nCount=5, tbProp={0, 8, 1, 10, nil, 0}},
	{szName="天蚕靴", nCount=5, tbProp={0, 5, 1, 10, nil, 0}},
	{szName="天蚕腰带", nCount=5, tbProp={0, 6, 0, 10, nil, 0}},
	{szName="掩日盔", nCount=5, tbProp={0, 7, 4, 10, nil, 0}},
	{szName="钻石戒指", nCount=5, tbProp={0, 3, 0, 10, nil, 0}},

}


local tbDropItem = {}
function tbDropItem:DropItemdByRate(tbItem, szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
	if tbItem == nil then
		return 0
	end
	local rtotal = 10000000
	local rcur=random(1,rtotal);
	local rstep=0;
	for i=1,getn(tbItem) do
		rstep=rstep+floor(tbItem[i].nRate*rtotal/100);
		if(rcur <= rstep) then
			return self:DropItemByList(tbItem[i], szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
		end
	end
end

function tbDropItem:DropItemByList(tbItem, szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
	if not tbItem then --物品表为空
		self:Debug("物品表为空.")
		return 0
	end
	if type(tbItem[1]) == "table" then -- 如果是多个物品
		if tbItem[1].nRate then --按概率给某一个
			return self:DropItemdByRate(tbItem, szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
		else --按顺序给全部
			for i = 1,  getn(tbItem) do
				self:DropItemByList(tbItem[i], szLogTitle, nMapId, nPosX32, nPosY32, nSeries)
			end	
			return 1;
		end
	end
	local tbItemProp	= tbItem.tbProp;
	local nItemCount	= tbItem.nCount or 1
	if tbItemProp then --物品
		local nItemIndex	= 0;
		for i = 1, nItemCount do
			local nQuality		= tbItem.nQuality or 0
			local nGoldRow		= 0
			local nItemSeries	= 0;
			local nItemLevel	= 0;
			local nItemLuck		= 0;
			if nQuality == 0 then
				nItemLevel = tbItemProp[4] or 1 --默认等级
				
				if (not tbItemProp[5]) then
					nItemSeries = nSeries or 0
					
				else
					nItemSeries = tbItemProp[5];
				end
				
				nItemLuck = tbItemProp[6] or 0
			elseif nQuality == 1 then
				nGoldRow = 1
			end
			nItemIndex = DropItemEx( SubWorldID2Idx(nMapId), nPosX32, nPosY32, -1,4, 0, nQuality, tbItemProp[1], tbItemProp[2] - nGoldRow, tbItemProp[3] or 0, nItemLevel, nItemSeries, nItemLuck,0,0,0,0,0)
			if nItemIndex <= 0 then
				return 0
			end
			if type(tbItem.CallBack) == "function" then
				tbItem.CallBack(nItemIndex)
			end
		end
		local szItemName = tbItem.szName or GetItemName(nItemIndex) --同类物品因此选最后的Index名字也一样
		self:WriteLog(szLogTitle, format("get %d item %s", nItemCount, szItemName))
	end
	if tbItem.nJxb then --剑侠币
		
	end
	return 1
end

function tbDropItem:WriteLog(szLogTitle, szMsg)
--	if szLogTitle then
--		WriteLog(format("[%s]\t%s\tAccount:%s\tName:%s\t%s.",szLogTitle,GetLocalDate("%Y-%m-%d %H:%M"), GetAccount(), GetName(), szMsg))
--	else
--		self:Debug("添加物品函数没有日志。")
--	end
end
--Include("\\script\\event\\shengdan_jieri\\200811\\newboss\\actclass.lua")
function OnDeath( nNpcIndex )
	local x, y, nMapIndex = GetNpcPos(nNpcIndex);
	local nSeries = GetNpcSeries(nNpcIndex);
	
	%tbDropItem:DropItemByList(%tbAwardItem, "Chunjie_Jieri2009_newboss_death", SubWorldIdx2ID(nMapIndex),x, y, nSeries)
	
end;


function OnTimer(nNpcIndex, nTimeOut)
	DelNpc(nNpcIndex)
end