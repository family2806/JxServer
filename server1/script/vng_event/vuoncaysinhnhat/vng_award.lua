Include("\\script\\lib\\awardtemplet.lua")
tbSpecialAward = {}
tbSpecialAward.tbAward = 
{
	[1] = {szName="紫蟒盔图谱",tbProp={6,1,2714,1,0,0},nCount=1},
	[2] = {szName="紫蟒衣图谱",tbProp={6,1,2715,1,0,0},nCount=1},
	[3] = {szName="紫蟒腰带图谱",tbProp={6,1,2717,1,0,0},nCount=1},
	[4] = {szName="紫蟒护腕图谱",tbProp={6,1,2718,1,0,0},nCount=1},
	[5] = {szName="紫莽玉佩图谱",tbProp={6,1,2720,1,0,0},nCount=1},
	[6] = {szName="紫蟒鞋图谱",tbProp={6,1,2716,1,0,0},nCount=1},
	[7] = {szName="紫蟒项链图谱",tbProp={6,1,2719,1,0,0},nCount=1},
	[8] = {szName="紫蟒上戒指图谱",tbProp={6,1,2721,1,0,0},nCount=1},
	[9] = {szName="紫蟒下戒指图谱",tbProp={6,1,2722,1,0,0},nCount=1},
	[10] = {szName="紫蟒器械图谱",tbProp={6,1,2723,1,0,0},nCount=1},
}
tbSpecialAward.tbAward2 = 
{
	[3] = --项链比例为65%
	{
              [1] = --少林		
              {
			{szName="紫蟒无相珠链",tbProp={0,1825},nCount=1,nQuality = 1,},
			{szName="紫蟒四空佛珠",tbProp={0,1835},nCount=1,nQuality = 1,},
			{szName="紫蟒清净项链",tbProp={0,1845},nCount=1,nQuality = 1,},
		},
		[2] = --天王
		{
			{szName="紫蟒崇明链",tbProp={0,1855},nCount=1,nQuality = 1,},
			{szName="紫蟒定海项链",tbProp={0,1865},nCount=1,nQuality = 1,},
			{szName="紫蟒宣威项链",tbProp={0,1875},nCount=1,nQuality = 1,},
		},
		[3] = --峨眉
		{
			{szName="紫蟒出尘珠链",tbProp={0,1885},nCount=1,nQuality = 1,},
			{szName="紫蟒沐雪珠链",tbProp={0,1895},nCount=1,nQuality = 1,},
		},
		[4] = --翠烟
		{
			{szName="紫蟒青霜珠链",tbProp={0,1905},nCount=1,nQuality = 1,},
			{szName="紫蟒砌香珠链",tbProp={0,1915},nCount=1,nQuality = 1,},
		},
		[5] = --五毒
		{
			{szName="紫蟒蚀骨项链",tbProp={0,1925},nCount=1,nQuality = 1,},
			{szName="紫蟒穿心项链",tbProp={0,1935},nCount=1,nQuality = 1,},
		},
		[6] = --唐门
		{
			{szName="紫蟒狼牙项链",tbProp={0,1945},nCount=1,nQuality = 1,},
			{szName="紫蟒青雾项链",tbProp={0,1955},nCount=1,nQuality = 1,},
			{szName="紫蟒风霜项链",tbProp={0,1965},nCount=1,nQuality = 1,},
		},
		[7] = --丐帮
		{
			{szName="紫蟒密云项链",tbProp={0,1975},nCount=1,nQuality = 1,},
			{szName="紫蟒火云项链",tbProp={0,1985},nCount=1,nQuality = 1,},
		},
		[8] = --天忍
		{
			{szName="紫蟒熔金项圈",tbProp={0,1995},nCount=1,nQuality = 1,},
			{szName="紫蟒燎原项链",tbProp={0,2005},nCount=1,nQuality = 1,},
		},
		[9] = --武当
		{
			{szName="紫蟒真元符",tbProp={0,2015},nCount=1,nQuality = 1,},
			{szName="紫蟒真武符",tbProp={0,2025},nCount=1,nQuality = 1,},
		},
		[10] = --昆仑
		{
			{szName="紫蟒断水项链",tbProp={0,2035},nCount=1,nQuality = 1,},
			{szName="紫蟒摘星符",tbProp={0,2045},nCount=1,nQuality = 1,},
		},
	},
	[4] = --上戒比例 15%
	{
		[1] = --少林
		{
			{szName="紫蟒无相上戒",tbProp={0,1827},nCount=1,nQuality = 1,},
			{szName="紫蟒四空上戒",tbProp={0,1837},nCount=1,nQuality = 1,},
			{szName="紫蟒清净上戒",tbProp={0,1847},nCount=1,nQuality = 1,},
		},
		[2] = --天王
		{
			{szName="紫蟒崇明上戒",tbProp={0,1857},nCount=1,nQuality = 1,},
			{szName="紫蟒紫蟒定海上戒",tbProp={0,1867},nCount=1,nQuality = 1,},
			{szName="紫蟒宣威上戒",tbProp={0,1877},nCount=1,nQuality = 1,},
		},
		[3] = --峨眉
		{
			{szName="紫蟒出尘上戒",tbProp={0,1887},nCount=1,nQuality = 1,},
			{szName="紫蟒沐雪上戒",tbProp={0,1897},nCount=1,nQuality = 1,},
		},
		[4] = --翠烟
		{
			{szName="紫蟒青霜上戒",tbProp={0,1907},nCount=1,nQuality = 1,},
			{szName="紫蟒砌香上戒",tbProp={0,1917},nCount=1,nQuality = 1,},
		},
		[5] = --五毒
		{
			{szName="紫蟒蚀骨上戒",tbProp={0,1927},nCount=1,nQuality = 1,},
			{szName="紫蟒穿心上戒",tbProp={0,1937},nCount=1,nQuality = 1,},
		},
		[6] = --唐门
		{
			{szName="紫蟒狼牙上戒",tbProp={0,1947},nCount=1,nQuality = 1,},
			{szName="紫蟒青雾上戒",tbProp={0,1957},nCount=1,nQuality = 1,},
			{szName="紫蟒风霜上戒",tbProp={0,1967},nCount=1,nQuality = 1,},
		},
		[7] = --丐帮
		{
			{szName="紫蟒密云上戒",tbProp={0,1977},nCount=1,nQuality = 1,},
			{szName="紫蟒火云上戒",tbProp={0,1987},nCount=1,nQuality = 1,},
		},
		[8] = --天忍
		{
			{szName="紫蟒熔金上戒",tbProp={0,1997},nCount=1,nQuality = 1,},
			{szName="紫蟒燎原上戒",tbProp={0,2007},nCount=1,nQuality = 1,},
		},
		[9] = --武当
		{
			{szName="紫蟒真元上戒",tbProp={0,2017},nCount=1,nQuality = 1,},
			{szName="紫蟒真武上戒",tbProp={0,2027},nCount=1,nQuality = 1,},
		},
		[10] = --昆仑
		{
			{szName="紫蟒断水上戒",tbProp={0,2037},nCount=1,nQuality = 1,},
			{szName="紫蟒摘星上戒",tbProp={0,2047},nCount=1,nQuality = 1,},
		},
	},
	[5] = --下戒比例16%
	{
		[1] = --少林
		{
			{szName="紫蟒无相下戒",tbProp={0,1834},nCount=1,nQuality = 1,},
			{szName="紫蟒四空下戒",tbProp={0,1844},nCount=1,nQuality = 1,},
			{szName="紫蟒清净下戒",tbProp={0,1854},nCount=1,nQuality = 1,},
		},
		[2] = --天王
		{
			{szName="紫蟒崇明下戒",tbProp={0,1864},nCount=1,nQuality = 1,},
			{szName="紫蟒定海下戒",tbProp={0,1874},nCount=1,nQuality = 1,},
			{szName="紫蟒宣威下戒",tbProp={0,1884},nCount=1,nQuality = 1,},
		},
		[3] = --峨眉
		{
			{szName="紫蟒出尘下戒",tbProp={0,1894},nCount=1,nQuality = 1,},
			{szName="紫蟒沐雪下戒",tbProp={0,1904},nCount=1,nQuality = 1,},
		},
		[4] = --翠烟
		{
			{szName="紫蟒青霜下戒",tbProp={0,1914},nCount=1,nQuality = 1,},
			{szName="紫蟒砌香下戒",tbProp={0,1924},nCount=1,nQuality = 1,},
		},
		[5] = --五毒
		{
			{szName="紫蟒蚀骨下戒",tbProp={0,1934},nCount=1,nQuality = 1,},
			{szName="紫蟒穿心下戒",tbProp={0,1944},nCount=1,nQuality = 1,},
		},
		[6] = --唐门
		{
			{szName="紫蟒狼牙下戒",tbProp={0,1954},nCount=1,nQuality = 1,},
			{szName="紫蟒青雾下戒",tbProp={0,1964},nCount=1,nQuality = 1,},
			{szName="紫蟒风霜下戒",tbProp={0,1974},nCount=1,nQuality = 1,},
		},
		[7] = --丐帮
		{
			{szName="紫蟒密云下戒",tbProp={0,1984},nCount=1,nQuality = 1,},
			{szName="紫蟒火云下戒",tbProp={0,1994},nCount=1,nQuality = 1,},
		},
		[8] = --天忍
		{
			{szName="紫蟒熔金下戒",tbProp={0,2004},nCount=1,nQuality = 1,},
			{szName="紫蟒燎原下戒",tbProp={0,2014},nCount=1,nQuality = 1,},
		},
		[9] = --武当
		{
			{szName="紫蟒真元下戒",tbProp={0,2024},nCount=1,nQuality = 1,},
			{szName="紫蟒真武下戒",tbProp={0,2034},nCount=1,nQuality = 1,},
		},
		[10] = --昆仑
		{
			{szName="紫蟒断水下戒",tbProp={0,2044},nCount=1,nQuality = 1,},
			{szName="紫蟒摘星下戒",tbProp={0,2054},nCount=1,nQuality = 1,},
		},
	},
	[6] = --器械比例4%
	{
		[1] = --少林
		{
			{szName="紫蟒无相缠手",tbProp={0,1831},nCount=1,nQuality = 1,},
			{szName="紫蟒四空僧棍",tbProp={0,1841},nCount=1,nQuality = 1,},
			{szName="紫蟒清净戒刀",tbProp={0,1851},nCount=1,nQuality = 1,},
		},
		[2] = --天王
		{
			{szName="紫蟒崇明锤",tbProp={0,1861},nCount=1,nQuality = 1,},
			{szName="紫蟒定海枪",tbProp={0,1871},nCount=1,nQuality = 1,},
			{szName="紫蟒宣威宝刀",tbProp={0,1881},nCount=1,nQuality = 1,},
		},
		[3] = --峨眉
		{
			{szName="紫蟒出尘剑",tbProp={0,1891},nCount=1,nQuality = 1,},
			{szName="紫蟒沐雪缠手",tbProp={0,1901},nCount=1,nQuality = 1,},
		},
		[4] = --翠烟
		{
			{szName="紫蟒青霜刀",tbProp={0,1911},nCount=1,nQuality = 1,},
			{szName="紫蟒砌香鸳鸯刀",tbProp={0,1921},nCount=1,nQuality = 1,},
		},
		[5] = --五毒
		{
			{szName="紫蟒蚀骨缠手",tbProp={0,1931},nCount=1,nQuality = 1,},
			{szName="紫蟒穿心刀",tbProp={0,1941},nCount=1,nQuality = 1,},
		},
		[6] = --唐门
		{
			{szName="紫蟒狼牙飞刀",tbProp={0,1951},nCount=1,nQuality = 1,},
			{szName="紫蟒青雾袖箭",tbProp={0,1961},nCount=1,nQuality = 1,},
			{szName="紫蟒风霜镖",tbProp={0,1971},nCount=1,nQuality = 1,},
		},
		[7] = --丐帮
		{
			{szName="紫蟒密云缠手",tbProp={0,1981},nCount=1,nQuality = 1,},
			{szName="紫蟒火云杖",tbProp={0,1991},nCount=1,nQuality = 1,},
		},
		[8] = --天忍
		{
			{szName="紫蟒熔金枪",tbProp={0,2001},nCount=1,nQuality = 1,},
			{szName="紫蟒燎原刀",tbProp={0,2011},nCount=1,nQuality = 1,},
		},
		[9] = --武当
		{
			{szName="紫蟒真元剑",tbProp={0,2021},nCount=1,nQuality = 1,},
			{szName="紫蟒真武剑",tbProp={0,2031},nCount=1,nQuality = 1,},
		},
		[10] = --昆仑
		{
			{szName="紫蟒断水刀",tbProp={0,2041},nCount=1,nQuality = 1,},
			{szName="紫蟒摘星剑",tbProp={0,2051},nCount=1,nQuality = 1,},	
		},
	},
}

tbSpecialAward.tbFaction = 
{
	[1] = "少林",
	[2] = "天王",
	[3] = "峨眉",
	[4] = "翠烟",
	[5] = "五毒",
	[6] = "唐门",
	[7] = "丐帮",
	[8] = "天忍",
	[9] = "武当",
	[10] = "昆仑",
}
tbSpecialAward.tbBranch = 
{
	[1] = {"拳法", "棍法", "刀法",},
	[2] = {"锤法", "枪法", "刀法",},
	[3] = {"剑法", "掌法", },
	[4] = {"刀法", "双刀", },
	[5] = {"掌法", "刀法"},
	[6] = {"飞刀", "袖箭", "飞镖",},
	[7] = {"掌法", "棍法",},
	[8] = {"枪法", "刀法"},
	[9] = {"掌法", "剑法", },
	[10] = {"刀法", "剑法", },
}
			
function tbSpecialAward:NguyetThan()
	local tbAward = {szName="幸运宝箱",tbProp={6,1,30110,1,0,0}, nExpiredTime = 1440, nBindState = -2, nCount=1, tbParam = {1}}
	tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", "PhanThuongCayThienTueNguyetThan"})
end

function tbSpecialAward:NguyetThan2(nItemIdx)
	local tbSay = {}
	for i = 1, 7 do
		tinsert(tbSay, format("%s/#tbSpecialAward:GetAward(%d, %d, %d)", self.tbAward[i].szName, nItemIdx, i, 1))
	end
	Say("请选择奖励", getn(tbSay), tbSay)
end

function tbSpecialAward:BachKim(nRateIndex)
	local tbItemName = 
	{		
		[3] = "紫蟒项链",
		[4] = "紫蟒上戒指",
		[5] = "紫蟒下戒指",
		[6] = "紫蟒器械",
	}
	local tbAward = {szName="幸运宝箱",tbProp={6,1,30110,1,0,0}, nExpiredTime = 1440, nBindState = -2, nCount=1, tbParam = {nRateIndex}}
	tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", "PhanThuongCayThienTueBachKim\t"..tbItemName[nRateIndex]})
end

function tbSpecialAward:BachKim2(nItemIdx, nRateIndex)
	local tbSay = {}
	for i = 1, getn(tbSpecialAward.tbFaction) do
		tinsert(tbSay, format("%s/#tbSpecialAward:ChooseBranch(%d, %d, %d)", tbSpecialAward.tbFaction[i], nItemIdx, nRateIndex, i))
	end
	local tbType = {[3]="项链", [4]="上戒指", [5]="下戒指", [6]="武器"}
	local strTittle = format("恭喜大侠获得奖励为1 <color=red>%s<color>, 请选门派:", tbType[nRateIndex])
	Say(strTittle, getn(tbSay), tbSay)
end

function tbSpecialAward:ChooseBranch(nItemIdx, nRateIndex, nFaction)
	local tbSay = {}
	for i = 1, getn(self.tbBranch[nFaction]) do
		tinsert(tbSay, format("%s/#tbSpecialAward:GetAward2(%d, %d, %d, %d)", self.tbFaction[nFaction].." "..self.tbBranch[nFaction][i], nItemIdx, nRateIndex, nFaction, i))
	end
	Say("请选择主导进攻系:", getn(tbSay), tbSay)
end

function tbSpecialAward:GetAward2(nItemIdx, nRateIndex, nFaction, nBranch)
	local tbAward = self.tbAward2[nRateIndex][nFaction][nBranch]
	if tbAward and IsMyItem(nItemIdx) == 1 and RemoveItemByIndex(nItemIdx) == 1 then
		tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", "PhanThuongBaoRuongBachKim"})
	end
end

function tbSpecialAward:BatTu()
	local tbAward = {szName="幸运宝箱",tbProp={6,1,30110,1,0,0}, nExpiredTime = 1440, nBindState = -2, nCount=1, tbParam = {2}}
	tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", "PhanThuongCayThienTueBatTu"})
end

function tbSpecialAward:BatTu2(nItemIdx)
	local tbSay = {}
	for i = 8, 9 do
		tinsert(tbSay, format("%s/#tbSpecialAward:GetAward(%d, %d, %d)", self.tbAward[i].szName, nItemIdx, i, 2))
	end
	Say("请选择奖励", getn(tbSay), tbSay)
end

function tbSpecialAward:GetAward(nItemIdx, nAwardIDX, nLogID)
	local tbLogList = 
	{
		[1] = "PhanThuongBaoRuongNguyetThan", 
		[2] = "PhanThuongBaoRuongBatTu"
	}
	local tbAward = self.tbAward[nAwardIDX]
	if IsMyItem(nItemIdx) == 1 and RemoveItemByIndex(nItemIdx) == 1 then
		tbAwardTemplet:Give(tbAward, 1, {"VuonCaySinhNhat", tbLogList[nLogID]})
	end
end

tbAwardList = {
	[1] = {szName = "i经验值", nExp=5000000},
	[2] = {szName = "i经验值", nExp=6000000},
	[3] = {szName = "i经验值", nExp=7000000},
	[4] = {szName = "i经验值", nExp=8000000},
	[5] = {szName = "i经验值", nExp=9000000},
	[6] = {szName = "i经验值", nExp=10000000},
	[7] = {	szName = "月神千年树奖励",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:NguyetThan()
				end},
	[8] = {	szName = "不死千年树奖励",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BatTu()
				end},
	[9] = {szName="紫蟒令",tbProp={6,1,2350,1,0,0},nCount=1},
	[10] = 
	{
		{	szName = "白金千岁树奖励1",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BachKim(3)
				end,
				nRate = 65,
		},
		{	szName = "白金千岁树奖励2",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BachKim(4)
				end,
				nRate = 15,
		},
		{	szName = "白金千岁树奖励3",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BachKim(5)
				end,
				nRate = 16,
		},
		{	szName = "白金千岁树奖励4",
				pFun = function (nItemCount, szLogTitle)
					%tbSpecialAward:BachKim(6)
				end,
				nRate = 4,
		},
	}
}